<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="Machine Learning, R Programming, Statistics, Artificial Intelligence">
    <meta name="author" content="Manuel Amunategui">
    <link rel="icon" href="../favicon.ico">

    <title>Google Video Intelligence, TensorFlow And Inception V3 - Recognizing Not-So-Famous-People</title>

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">

    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <link href="../ie10-viewport-bug-workaround.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="../blog.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

  </head>
<body>
  
 <div class="blog-masthead">
    <div class="container">
      <nav class="blog-nav">
        <a class="blog-nav-item active" href="../index.html">Home</a>
        <a class="blog-nav-item" href="https://www.linkedin.com/in/manuel-amunategui-20748923" target='_blank'>Linkedin</a>
        <a class="blog-nav-item" href="https://www.youtube.com/user/mamunate/videos" target='_blank'>Videos</a>
        <a class="blog-nav-item" href="https://github.com/amunategui/Feedback/issues/new" target='_blank'>Feedback</a>
      </nav>
    </div>
</div>

<div class="container">

  <div class="blog-header">
    <h1 class="blog-title">Google Video Intelligence, TensorFlow And Inception V3 - Recognizing Not-So-Famous-People</h1>
    <p class="lead blog-description">Practical walkthroughs on machine learning, data exploration and finding insight.</p>
  </div>
  

<p><strong>On YouTube:</strong></p>
<ul>
<li type="square"><a href="https://www.youtube.com/watch?v=a5E-W0Ck-8U&list=UUq4pm1i_VZqxKVVOz5qRBIA&index=1" target="_blank"><img src="img/youtube-image.png" alt="YouTube.com companion link" width="120" height="90" border="10" /></a></li>
</ul>

<BR><BR>
<p><strong>GitHub Repository:</strong></p>
<ul>
<li type="square"><a href="https://github.com/amunategui/rapid-prototyping-app-engine-yelp" target="_blank">GitHub: https://github.com/amunategui/rapid-prototyping-app-engine-yelp</a></li>
</ul>
<BR><BR>
This is the second part to the previous blog entry <a href='http://amunategui.github.io/google-actor-recognition/index.html' target='_blnak'>Google's Video Intelligence and Vision APIs - Automatically Recognize Actors and Download their Biographies in Real Time</a>.  

<p>The above celebrity pipeline can chew through a celebrity video faster than you can say protagonist - and that’s the whole point!</p>

<p>Can we divert some of that speed and instight towards something other than finding celebrities? What if you we wanted to identify regular people? Or any other entity not currently offered with Google Video Intelligence?</p>

<p>Yes, we can!</p>

<BR><BR> 
<p style="text-align:center">
<img src="img/app-engine-output.png" alt="Not-So-Famous-People" style='padding:1px; border:1px solid #021a40; width: 80%; height: 80%'>
</p>

<p>All we need to do is swap one step in the pipeline (albeit with some manual pre-processing work required). We remove the image web-search step and replace it with our own trained convolutional deep neural network. If you are trying to find out which family members are on a video, then a web search using headshots probably won't help you (unless they’re super famous). 

<p>Enters…</p>
 

<H2>Inception V3, Transfer Learning, And A Massive Modeling Shortcut</H2>

<p>Inception V3 is the third inception version of convolutional deep neural networks (CNN) trained to recognize general object categories using the famous ImageNet dataset.</p>

<blockquote>“The ImageNet project is a large visual database designed for use in visual object recognition software research. Over 14 million URLs of images have been hand-annotated by ImageNet to indicate what objects are pictured; in at least one million of the images, bounding boxes are also provided. ImageNet contains over 20 thousand ambiguous categories; a typical category, such as "balloon" or "strawberry", contains several hundred images.” 
<p style="text-align:right">
<a href='https://en.wikipedia.org/wiki/ImageNet' target='_blank'>Wikipedia Imagenet</a></p></blockquote>

<p>The V3 can differentiate between 1,000 different objects (<a href='http://image-net.org/challenges/LSVRC/2014/browse-synsets' target='_blank'>image-net.org</a>):

<BR><BR> 
<p style="text-align:center">
<img src="img/inception_v3_architecture.png" alt="inception v3 architecture" style='padding:1px; border:1px solid #021a40; width: 50%; height: 50%'>
</p>
<p>(<a href='https://github.com/tensorflow/models/blob/master/research/inception/README.md' target='_blank'>Inception in TensorFlow</a>)</p>
  

<p>Transfer learning is a big deal in supervised CNN modeling. Simply put, you can ask a model already trained on a set of object to recognize different ones. As you may know, large models require a lot of data and huge processing power with specialized hardware. Having the ability of piggy backing powerful and publicly-available models is a huge time saver!</p>
“Transfer learning or inductive transfer is a research problem in machine learning that focuses on storing knowledge gained while solving one problem and applying it to a different but related problem. For example, knowledge gained while learning to recognize cars could apply when trying to recognize trucks.” (<a href='https://en.wikipedia.org/wiki/Transfer_learning' target='_blank'>Wikipedia Transfer Learning</a>)</blockquote> </p>
  
<p>If its the first time you hear about this, you may wonder how a model that has only been trained to recognize mundane things like cars, fruits, trees, etc. can also be used to differentiate between my children.</p>

<p>The best way to convince yourself is to try it out. It turns out that this approach does a good job with new data and new labels spliced right at the end of the network. But the main takeawy is that it would take efforts in the multiples with big hardware, a whole lot more data and serious hyperparameter-tuning knowledge to do this from scratch.</p>

￼
<H2>Getting Started</H2>

You need to install <a href='https://www.tensorflow.org/install/index' target='_blank'>TensorFlow</a> or pip install it (pip install tensorflow) on your machine.
<p>
You’ll need to copy the <a href='https://github.com/tensorflow/tensorflow/blob/master/tensorflow/examples/image_retraining/retrain.py' target='_blank'>retrain.py</a> script (https://github.com/tensorflow/tensorflow/blob/master/tensorflow/examples/image_retraining/retrain.py) to you local machine. </p>
 

 
I have an entire blog post on Bootstrap - <a href='http://amunategui.github.io/free-website-on-github/index.html' target='_blank'>Show it to the World! Build a Free Art Portfolio Website on GitHub.io in 20 Minutes!</a>.

JavaScript and Ajax are great front-end scripting languages that add dynamic behavior to a web page. <a href='https://en.wikipedia.org/wiki/Ajax_(programming)' target='_blank'>Ajax</a> allows sending and receiving data without rebuilding the entire thing. This is what allows us to animate the Google Maps by making markers appear during the trip's progression. 

<BR><BR>
<H3>Anatomy of a Web Application</H3>
A typical folder structure for a Flask web application on Google's App Engine looks like:

<BR><BR><BR>
<p style="text-align:center">
<img src="img/flask-folder-structure.png" alt="flask-folder-structure.png" style='padding:1px; border:1px solid #021a40; width: 30%; height: 30%'>
</p>
<BR><BR>
<UL>
<LI><B>app.yaml</B> declares where the controlling Flask Python script resides along with the <b>static</b> and <b>templates</b> folder locations</LI>
<LI><B>appengine_config.py</B> points to the lib folder that holds any additional libraries</LI>
<LI><B>requirements.txt</B> holds library names and version to be installed and added to the lib folder</LI>
<LI><B>main.py</B> is the brains of the Flask operations and holds all of the Python code and directives for each HTML pages</LI>
</UL> 

If your code (modeling, data wrangling) isn't too complicated, you can house it all in main.py. In the template folder lives your HTML pages. Typically you will see an <b>index.html</b> page where a visitor first lands and any other subsequent pages depending on your application. In our case we also have a <b>maps.html</b> that will display the application results. The <b>static</b> folder (not used in this application) holds static things like images, videos, css, etc. We don't use one in this web application just to keep things simple and streamlined. All the code can be found on GitHub at: https://github.com/amunategui/rapid-prototyping-app-engine-yelp/tree/master/templates
<BR><BR>
<H2>Deploying on Google App Engine</H2>

And now for the easy part. There are multiple ways of deploying you web application on Google App Engine. In the <a href='https://www.youtube.com/watch?v=5z4v4qX2_7c' target='_blank'>video</a>, I show a way to link your GitHub (works with BitBucket as well) using the Google Cloud dashboard. But the easiest, especially if it isn't your repository or if you don't intend uploading back code changes, is to simply using the command line <b>git clone</b> call: 
<BR><BR>
<pre class="r"><code>git clone https://github.com/amunategui/rapid-prototyping-app-engine-yelp</code></pre>
<BR>
So log into your instance of Google Cloud and select the project you want your App Engine to live (if you don't have one see <a href='https://cloud.google.com/resource-manager/docs/creating-managing-projects' target='_blank'>Creating and Managing Projects</a>). Start the <a href='https://cloud.google.com/shell/' target='_blank'>cloud shell command line tool</a> by clicking on the upper-right caret button. This will open a familiar-looking command line window in the bottom half of the GCP dashboard.  
<BR><BR><BR>
<p style="text-align:center">
<img src="img/shell-start.png" alt="start cloud shell" style='padding:1px; border:1px solid #021a40; width: 60%; height: 60%'>
</p>
<BR><BR>
Run the git clone command above and you will see a new directory with the name <b>rapid-prototyping-app-engine-yelp</b> created under your root's directory. You're almost ready to deploy, we just need to add our API keys in three different places. Enter the new folder and open up the <b>main.py</b> file to add the keys:
<BR><BR>
<pre class="r"><code>cd rapid-prototyping-app-engine-yelp
vi main.py</code></pre>
<BR>
Once in the <b>vi</b> editor, hit the <b>i</b> key to get in insert mode and scroll down until you find the API variables for both Google and Yelp (highlighted in green in the screenshot).
<BR><BR><BR>
<p style="text-align:center">
<img src="img/command-line-update.png" alt="command line edit" style='padding:1px; border:1px solid #021a40; width: 70%; height: 70%'>
</p>
<BR><BR>
Once you are done, hit the <b>escape</b> key to get out of <b>Insert</b> mode and type <b>:wq</b> to save and quit out of vi (if you want additional on <b>vi</b> help check out the <a href='https://www.cs.colostate.edu/helpdocs/vi.html' target='_blank'>Colorado State CS help doc</a>). One more file to fix and we can deploy. 

Navigate to the <b>templates</b> folder and edit the <b>map.html</b> file:

<BR><BR>
<pre class="r"><code>cd templates
vi map.html</code></pre>
<BR>
Hit the <b>i</b> key again to get into insert mode and add your Google Key as indicated in the code:
<BR><BR><BR>
<p style="text-align:center">
<img src="img/command-line-update-2.png" alt="command line edit" style='padding:1px; border:1px solid #021a40; width: 70%; height: 70%'>
</p>
<BR><BR>
Once again, hit the <b>escape</b> key to get out of <b>Insert</b> mode and type <b>:wq</b> to save and quit out of vi. Navigate back to the <b>rapid-prototyping-app-engine-yelp</b> folder: 
<BR><BR>
<pre class="r"><code>cd ..</code></pre>
<BR><BR>
<h3>Deploying our Web Application</h3>
Almost there, if you look in the <b>requirements.txt</b> file, you will see a series of Python libraries that are required to run the application. When you build your own application, this is where you list all the libraries needed, you then run the script to actually install them the <b>lib</b> folder. A word of caution, the <b>Standard Environment</b> version of the Google App Engine only supports a minimal set of libraries, for anything more complicated (like writing/reading to files) you will need to use the <b>Flexible Environment</b>.

So run the following command to install all the needed additional libraries to the lib folder. When you deploy your web app, the lib folder will travel along with the needed libraries.
 <BR><BR>
<pre class="r"><code>pip install -t lib -r requirements.txt</code></pre>
<BR>
Next initialize gcloud with the following command and answer a series of questions:
<pre class="r"><code>gcloud init</code></pre>
<BR>
And answer the following questions:

<BR><BR><BR>
<p style="text-align:center">
<img src="img/gcloud-init-question-1.png" alt="gcloud question 1" style='padding:1px; border:1px solid #021a40; width: 70%; height: 70%'>
</p>

<BR><BR><BR>

<p style="text-align:center">
<img src="img/gcloud-init-question-2.png" alt="gcloud question 2" style='padding:1px; border:1px solid #021a40; width: 70%; height: 70%'>
</p>

<BR><BR><BR>
<p style="text-align:center">
<img src="img/gcloud-init-question-3.png" alt="gcloud question 3" style='padding:1px; border:1px solid #021a40; width: 70%; height: 70%'>
</p>
<BR>
<BR> Finally deploy it to the world with the following command:</p>
<pre class="r"><code>gcloud app deploy</code></pre>
<BR><BR><BR>
<p style="text-align:center">
<img src="img/deploy-question-1.png" alt="deploy question 1" style='padding:1px; border:1px solid #021a40; width: 70%; height: 70%'>
</p>
<BR><BR><BR>
<p style="text-align:center">
<img src="img/deploy-question-2.png" alt="deploy question 2" style='padding:1px; border:1px solid #021a40; width: 70%; height: 70%'>
</p>
<BR><BR>
  

After a few minutes, it will state it is done and offer you the handy command <b>gcloud app browse</b>. If you use it, it will yield a clickable link to jump to your new web application.

<BR><BR><BR>
<p style="text-align:center">
<img src="img/ready-to-deploy-path.png" alt="get the URL" style='padding:1px; border:1px solid #021a40; width: 70%; height: 70%'>
</p>
<BR><BR>

And now for the fun part, let's deploy this to the world!
<BR><BR><BR>
<p style="text-align:center">
<img src="img/trip-seattle-sanfran.jpg" alt="finally trip data" style='padding:1px; border:1px solid #021a40; width: 70%; height: 70%'>
</p>
<BR><BR>


</div>
</body>
</html>
